var positions = [0, 0, 0, 0, 0, 0, 0, 0, 0];
var hod = 'red';
var all_h = 0;
var players = ['red', 'green'];

function carry(callback, arglist) {
  var thisObj = this;
  return (function () {
    callback.apply(thisObj, arglist)
  });
}

function clear() {
  var cla = document.getElementsByClassName('sectors');
  for (var x = 0; cla.length > x; x++) {
    var canv = cla[x].getContext('2d');
    canv.fillStyle = 'white';
    canv.rect(0, 0, cla[x].width, cla[x].height);
    canv.fill();
  }
  positions = [0, 0, 0, 0, 0, 0, 0, 0, 0];
  all_h = 0;
  hod = 'red';
  bot();
}

function check_win() {
  // 0  1  2
  // 3  4  5
  // 6  7  8
  var sovp = 0;
  var mas = [[0, 1, 2],
    [3, 4, 5],
    [6, 7, 8],
    [0, 3, 6],
    [1, 4, 7],
    [2, 5, 8],
    [0, 4, 8],
    [2, 4, 6]]
  var win = false;
  for (var play = 1; play < 3; play++) {
    for (var i = 0; mas.length > i; i++) {
      var mas2 = mas[i];
      for (var x = 0; mas2.length > x; x++) {
        if (positions[mas2[x]] === play) {
          sovp++;
        }
      }
      if (sovp === 3) {
        alert('winner: ' + players[play - 1]);
        clear();
        return true;
      }
      sovp = 0;
    }
  }
  return false
}

function bot() {
  // 0  1  2
  // 3  4  5
  // 6  7  8
  var cla = document.getElementsByClassName('sectors');
  var mas = [
    [[0,0,0,0,0,0,0,0,0], 4],
    [[0,2,0,0,1,0,0,0,0], 2],
    [[0,2,1,0,1,0,2,0,0], 8],
    [[2,2,1,0,1,0,2,0,1], 5],
    [[0,2,0,0,1,0,0,0,0], 2],
    [[0,2,1,0,1,0,2,0,0], 8],
    [[0,2,1,0,1,2,2,0,1], 0],
    [[0,2,0,0,1,0,0,0,0], 2],
    [[0,2,1,0,1,0,2,0,0], 8],
    [[0,2,1,0,1,0,2,2,1], 0],
    [[0,2,0,0,1,0,0,0,0], 2],
    [[0,2,1,0,1,0,2,0,0], 8],
    [[0,2,1,2,1,0,2,0,1], 0],
    [[0,2,0,0,1,0,0,0,0], 2],
    [[2,2,1,0,1,0,0,0,0], 6],
    [[0,2,0,0,1,0,0,0,0], 2],
    [[0,2,1,2,1,0,0,0,0], 6],
    [[0,2,0,0,1,0,0,0,0], 2],
    [[0,2,1,0,1,0,0,2,0], 6],
    [[0,2,0,0,1,0,0,0,0], 2],
    [[0,2,1,0,1,0,0,0,2], 6],
    [[0,2,0,0,1,0,0,0,0], 2],
    [[0,2,1,0,1,2,0,0,0], 6],
    [[2,0,0,0,1,0,0,0,0], 1],
    [[2,1,0,0,1,0,0,2,0], 5],
    [[2,1,0,2,1,1,0,2,0], 6],
    [[2,1,2,2,1,1,1,2,0], 8],
    [[2,0,0,0,1,0,0,0,0], 1],
    [[2,1,0,0,1,0,2,0,0], 7],
    [[2,0,0,0,1,0,0,0,0], 1],
    [[2,1,0,0,1,0,0,0,2], 7],
    [[2,0,0,0,1,0,0,0,0], 1],
    [[2,1,0,0,1,2,0,0,0], 7],
    [[2,0,0,0,1,0,0,0,0], 1],
    [[2,1,2,0,1,0,0,0,0], 7],
    [[2,0,0,0,1,0,0,0,0], 1],
    [[2,1,0,0,1,0,0,2,0], 5],
    [[2,1,0,0,1,1,2,2,0], 3],
    [[2,0,0,0,1,0,0,0,0], 1],
    [[2,1,0,0,1,0,0,2,0], 5],
    [[2,1,0,0,1,1,0,2,2], 3],
    [[2,0,0,0,1,0,0,0,0], 1],
    [[2,1,0,0,1,0,0,2,0], 5],
    [[2,1,2,0,1,1,0,2,0], 3],
    [[2,0,0,0,1,0,0,0,0], 1],
    [[2,1,0,0,1,0,0,2,0], 5],
    [[2,1,0,2,1,1,0,2,0], 6],
    [[2,1,0,2,1,1,1,2,2], 2],
    [[2,0,0,0,1,0,0,0,0], 1],
    [[2,1,0,2,1,0,0,0,0], 7],
    [[0,0,0,2,1,0,0,0,0], 0],
    [[1,0,0,2,1,0,0,0,2], 2],
    [[1,0,1,2,1,0,2,0,2], 1],
    [[0,0,0,2,1,0,0,0,0], 0],
    [[1,0,0,2,1,0,0,0,2], 2],
    [[1,2,1,2,1,0,0,0,2], 6],
    [[0,0,0,2,1,0,0,0,0], 0],
    [[1,2,0,2,1,0,0,0,0], 8],
    [[0,0,0,2,1,0,0,0,0], 0],
    [[1,0,0,2,1,0,2,0,0], 8],
    [[0,0,0,2,1,0,0,0,0], 0],
    [[1,0,0,2,1,0,0,2,0], 8],
    [[0,0,0,2,1,0,0,0,0], 0],
    [[1,0,0,2,1,2,0,0,0], 8],
    [[0,0,0,2,1,0,0,0,0], 0],
    [[1,0,2,2,1,0,0,0,0], 8],
    [[0,0,0,2,1,0,0,0,0], 0],
    [[1,0,0,2,1,0,0,0,2], 2],
    [[1,0,1,2,1,2,0,0,2], 1],
    [[0,0,0,2,1,0,0,0,0], 0],
    [[1,0,0,2,1,0,0,0,2], 2],
    [[1,0,1,2,1,0,0,2,2], 1],
    [[0,0,0,0,1,0,2,0,0], 8],
    [[2,0,0,0,1,0,2,0,1], 3],
    [[2,0,0,1,1,2,2,0,1], 2],
    [[2,2,1,1,1,2,2,0,1], 7],
    [[0,0,0,0,1,0,2,0,0], 8],
    [[0,0,0,0,1,0,2,2,1], 0],
    [[0,0,0,0,1,0,2,0,0], 8],
    [[0,0,0,0,1,2,2,0,1], 0],
    [[0,0,0,0,1,0,2,0,0], 8],
    [[0,0,0,2,1,0,2,0,1], 0],
    [[0,0,0,0,1,0,2,0,0], 8],
    [[0,0,2,0,1,0,2,0,1], 0],
    [[0,0,0,0,1,0,2,0,0], 8],
    [[0,2,0,0,1,0,2,0,1], 0],
    [[0,0,0,0,1,0,2,0,0], 8],
    [[2,0,0,0,1,0,2,0,1], 3],
    [[2,0,0,1,1,0,2,2,1], 5],
    [[0,0,0,0,1,0,2,0,0], 8],
    [[2,0,0,0,1,0,2,0,1], 3],
    [[2,0,2,1,1,0,2,0,1], 5],
    [[0,0,0,0,1,0,2,0,0], 8],
    [[2,0,0,0,1,0,2,0,1], 3],
    [[2,2,0,1,1,0,2,0,1], 5],
    [[0,0,0,0,1,0,2,0,0], 8],
    [[2,0,0,0,1,0,2,0,1], 3],
    [[2,0,0,1,1,2,2,0,1], 2],
    [[2,0,1,1,1,2,2,2,1], 1],
    [[0,0,0,0,1,0,0,2,0], 8],
    [[2,0,0,0,1,0,0,2,1], 2],
    [[2,0,1,0,1,2,0,2,1], 6],
    [[0,0,0,0,1,0,0,2,0], 8],
    [[2,0,0,0,1,0,0,2,1], 2],
    [[2,0,1,0,1,0,2,2,1], 5],
    [[0,0,0,0,1,0,0,2,0], 8],
    [[2,0,0,0,1,0,0,2,1], 2],
    [[2,2,1,0,1,0,0,2,1], 6],
    [[0,0,0,0,1,0,0,2,0], 8],
    [[2,0,0,0,1,0,0,2,1], 2],
    [[2,0,1,2,1,0,0,2,1], 5],
    [[0,0,0,0,1,0,0,2,0], 8],
    [[0,0,0,0,1,2,0,2,1], 0],
    [[0,0,0,0,0,0,0,0,0], 4],
    [[0,0,0,0,1,0,0,2,0], 8],
    [[0,0,2,0,1,0,0,2,1], 0],
    [[0,0,0,0,1,0,0,2,0], 8],
    [[0,2,0,0,1,0,0,2,1], 0],
    [[0,0,0,0,1,0,0,2,0], 8],
    [[0,0,0,2,1,0,0,2,1], 0],
    [[0,0,0,0,1,0,0,0,2], 7],
    [[0,2,0,0,1,0,0,1,2], 5],
    [[0,2,0,2,1,1,0,1,2], 0],
    [[1,2,2,2,1,1,0,1,2], 6],
    [[0,0,0,0,1,0,0,0,2], 7],
    [[0,0,0,0,1,2,0,1,2], 1],
    [[0,0,0,0,1,0,0,0,2], 7],
    [[0,0,0,0,1,0,2,1,2], 1],
    [[0,0,0,0,1,0,0,0,2], 7],
    [[0,0,0,2,1,0,0,1,2], 1],
    [[0,0,0,0,1,0,0,0,2], 7],
    [[2,0,0,0,1,0,0,1,2], 1],
    [[0,0,0,0,1,0,0,0,2], 7],
    [[0,0,2,0,1,0,0,1,2], 1],
    [[0,0,0,0,1,0,0,0,2], 7],
    [[0,2,0,0,1,0,0,1,2], 5],
    [[0,2,0,0,1,1,2,1,2], 3],
    [[0,0,0,0,1,0,0,0,2], 7],
    [[0,2,0,0,1,0,0,1,2], 5],
    [[2,2,0,0,1,1,0,1,2], 3],
    [[0,0,0,0,1,0,0,0,2], 7],
    [[0,2,0,0,1,0,0,1,2], 5],
    [[0,2,2,0,1,1,0,1,2], 3],
    [[0,0,0,0,1,0,0,0,2], 7],
    [[0,2,0,0,1,0,0,1,2], 5],
    [[0,2,0,2,1,1,0,1,2], 0],
    [[1,2,0,2,1,1,2,1,2], 2],
    [[0,0,0,0,1,2,0,0,0], 2],
    [[0,0,1,0,1,2,2,0,0], 0],
    [[1,0,1,0,1,2,2,0,2], 1],
    [[0,0,0,0,1,2,0,0,0], 2],
    [[0,0,1,0,1,2,0,0,2], 6],
    [[0,0,0,0,1,2,0,0,0], 2],
    [[0,0,1,0,1,2,0,2,0], 6],
    [[0,0,0,0,1,2,0,0,0], 2],
    [[0,0,1,2,1,2,0,0,0], 6],
    [[0,0,0,0,1,2,0,0,0], 2],
    [[2,0,1,0,1,2,0,0,0], 6],
    [[0,0,0,0,1,2,0,0,0], 2],
    [[0,0,1,0,1,2,2,0,0], 0],
    [[1,0,1,0,1,2,2,2,0], 1],
    [[0,0,0,0,1,2,0,0,0], 2],
    [[0,0,1,0,1,2,2,0,0], 0],
    [[1,0,1,2,1,2,2,0,0], 1],
    [[0,0,0,0,1,2,0,0,0], 2],
    [[0,0,1,0,1,2,2,0,0], 0],
    [[1,2,1,0,1,2,2,0,0], 8],
    [[0,0,2,0,1,0,0,0,0], 1],
    [[0,1,2,0,1,0,0,2,0], 5],
    [[0,1,2,2,1,1,0,2,0], 0],
    [[1,1,2,2,1,1,0,2,2], 6],
    [[0,0,2,0,1,0,0,0,0], 1],
    [[0,1,2,0,1,2,0,0,0], 7],
    [[0,0,2,0,1,0,0,0,0], 1],
    [[0,1,2,0,1,0,0,0,2], 7],
    [[0,0,2,0,1,0,0,0,0], 1],
    [[0,1,2,0,1,0,2,0,0], 7],
    [[0,0,2,0,1,0,0,0,0], 1],
    [[0,1,2,2,1,0,0,0,0], 7],
    [[0,0,2,0,1,0,0,0,0], 1],
    [[0,1,2,0,1,0,0,2,0], 5],
    [[0,1,2,0,1,1,0,2,2], 3],
    [[0,0,2,0,1,0,0,0,0], 1],
    [[0,1,2,0,1,0,0,2,0], 5],
    [[0,1,2,0,1,1,2,2,0], 3],
    [[0,0,2,0,1,0,0,0,0], 1],
    [[0,1,2,0,1,0,0,2,0], 5],
    [[0,1,2,2,1,1,0,2,0], 0],
    [[1,1,2,2,1,1,2,2,0], 8],
  ]
  for (var i = 0; mas.length > i; i++) {
    var mas2 = mas[i];
    if (JSON.stringify(mas2[0]) === JSON.stringify(positions)) {
      //ffff
      click(mas2[1], cla[mas2[1]]);
    }
  }
}

function click(number1, c) {
  if (positions[number1] === 0) {
    var canv = c.getContext('2d')
    canv.fillStyle = hod;
    canv.rect(0, 0, c.width, c.height);
    canv.fill();
    positions[number1] = players.indexOf(hod) + 1;
    if (hod === 'red') {
      hod = 'green';
    } else {
      hod = 'red';
      bot();
    }
    all_h++;
    if (check_win()) {
    } else {
      if (all_h === 9) {
        alert('Всё ничья!');
        hod = 'red';
        all_h = 0;
        clear();
      }
    }
  } else {
    alert('Поле занято!');
  }
  document.getElementById('playe').innerText = 'Ход игрока: ' + hod;
  document.getElementById('playe').style.color = hod;
}

window.onload = function (e) {
  document.getElementById('playe').innerText = 'Ход игрока: ' + hod;
  document.getElementById('playe').style.color = hod;
  var z = 0;
  for (var i = 0; i < 9; i++) {
    var d = document.getElementById('game');
    var sector = document.createElement('canvas');
    sector.height = (window.innerHeight + window.innerWidth) / 3 / 3.25;
    sector.width = (window.innerHeight + window.innerWidth) / 3 / 3.25;
    sector.style.border = 'solid black 5px';
    sector.onclick = carry(click, [i, sector]);
    sector.className = 'sectors';
    sector.addEventListener("mouseover", function () {
      this.style.border = 'solid blue 5px';
    });
    sector.addEventListener("mouseleave", function () {
      this.style.border = 'solid black 5px';
    });
    d.appendChild(sector);
    z++;
    if (z === 3) {
      d.appendChild(document.createElement('br'));
      z = 0;
    }
  }
  bot();
}

